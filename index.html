<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch thi</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    <style>
		/* CSS cho trang khi in */
        @media print {
            body * {
                visibility: hidden;
            }
            .container, .container * {
                visibility: visible;
            }
            .container {
                position: absolute;
                left: 0;
                top: 0;
            }
        }
		.container {
			max-width: 1300px;
			margin-left: auto;
			margin-right: auto;
			font-size: 14px;
		}
		/* gioi han chieu rong */
        .container table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
		.container th, .container td {
            white-space: nowrap; /* Ngăn chữ trong ô xuống dòng */
            max-width: 70px; /* Giới hạn chiều rộng của ô */
			
        }
		.action {
			color: red;
		}

    </style>
</head>
<body>
	<input type="file" id="excel-file" accept=".xlsx, .xls" onchange="handleFile(this)">
    <h1>Semester exam schedule</h1>
	<h2>Action: <span class="action">scheduling</span></h2>
	<button onclick="reloadPage()">View exam schedule</button>
	<button onclick="reloadPage()">scheduling</button>
	<button onclick="printSchedule()">Print exam schedule</button>
	<button onclick="exportToExcel()">Save to Excel</button>
	<button onclick="formatDataDisplay()">Format Data Display</button>
	<button onclick="reloadPage()">Reload</button>
	<div class="container">
    <table id="excel-data">
		<thead>
			<tr>
				<th>TT</th>
				<th>Lớp HP</th>
				<th>Mã HP</th>
				<th>Tên học phần</th>
				<th>Số TC</th>
				<th>SL</th>
				<th>HT Thi</th>
				<th>Buổi</th>
				<th>Giờ thi</th>
				<th>Ngày thi</th>
				<th>Phòng thi</th>
				<th>GV chấm thi 1</th>
				<th>GV chấm thi 2</th>
				<th>CT 1</th>
				<th>CT 2</th>
				<th>Thứ</th>
				<th>Lớp</th>
				<th>Khóa</th>
			</tr>
		</thead>
		<tbody id="scheduleBody">
		</tbody>
    </table>
	</div>
	<script>
		// initialize data
		const data = [
			{
				"TT": 1,
				"Lớp HP": "ABC123",
				"Mã HP": "CSE101",
				"Tên học phần": "Lập trình cơ bản",
				"Số TC": 3,
				"SL": 50,
				"HT Thi": "Thi viết",
				"Buổi": "Sáng",
				"Giờ thi": "8:00 - 10:00",
				"Ngày thi": "25/04/2024",
				"Phòng thi": "Phòng A101",
				"GV chấm thi 1": "Nguyễn Văn A",
				"GV chấm thi 2": "Nguyễn Văn B",
				"CT 1": "",
				"CT 2": "",
				"Thứ": 2,
				"Lớp": "12C1",
				"Khóa": 12
			},
			{
				"TT": 2,
				"Lớp HP": "DEF456",
				"Mã HP": "MTH202",
				"Tên học phần": "Toán cao cấp",
				"Số TC": 4,
				"SL": 40,
				"HT Thi": "Thi trắc nghiệm",
				"Buổi": "Chiều",
				"Giờ thi": "14:00 - 16:00",
				"Ngày thi": "26/04/2024",
				"Phòng thi": "Phòng B202",
				"GV chấm thi 1": "Phạm Thị C",
				"GV chấm thi 2": "Nguyễn Văn D",
				"CT 1": "",
				"CT 2": "",
				"Thứ": 3,
				"Lớp": "12C2",
				"Khóa": 12
			},
			{
				"TT": 3,
				"Lớp HP": "GHI789",
				"Mã HP": "ENG101",
				"Tên học phần": "Tiếng Anh cơ bản",
				"Số TC": 2,
				"SL": 30,
				"HT Thi": "Thi lý thuyết",
				"Buổi": "Sáng",
				"Giờ thi": "9:00 - 11:00",
				"Ngày thi": "27/04/2024",
				"Phòng thi": "Phòng C303",
				"GV chấm thi 1": "Lê Thị E",
				"GV chấm thi 2": "Trần Văn F",
				"CT 1": "",
				"CT 2": "",
				"Thứ": 4,
				"Lớp": "12C3",
				"Khóa": 12
			},
			{
				"TT": 4,
				"Lớp HP": "XYZ789",
				"Mã HP": "PHY303",
				"Tên học phần": "Vật lý cơ bản",
				"Số TC": 3,
				"SL": 45,
				"HT Thi": "Thi thực hành",
				"Buổi": "Chiều",
				"Giờ thi": "13:00 - 15:00",
				"Ngày thi": "28/04/2024",
				"Phòng thi": "Phòng D404",
				"GV chấm thi 1": "Hoàng Văn G",
				"GV chấm thi 2": "Nguyễn Thị H",
				"CT 1": "",
				"CT 2": "",
				"Thứ": 5,
				"Lớp": "12C4",
				"Khóa": 12
			},
			{
				"TT": 5,
				"Lớp HP": "JKL321",
				"Mã HP": "BIO202",
				"Tên học phần": "Sinh học cơ bản",
				"Số TC": 3,
				"SL": 40,
				"HT Thi": "Thi thực hành",
				"Buổi": "Sáng",
				"Giờ thi": "10:00 - 12:00",
				"Ngày thi": "29/04/2024",
				"Phòng thi": "Phòng E505",
				"GV chấm thi 1": "Trần Văn I",
				"GV chấm thi 2": "Lê Thị K",
				"CT 1": "",
				"CT 2": "",
				"Thứ": 6,
				"Lớp": "12C5",
				"Khóa": 12
			}
		];
		 const scheduleBody = document.getElementById('scheduleBody');

        // Create and populate tables with data
        data.forEach(row => {
            const tr = document.createElement('tr');
            for (const key in row) {
                const td = document.createElement('td');
                td.textContent = row[key];
                tr.appendChild(td);
            }
            scheduleBody.appendChild(tr);
        });
	</script>
	<script>
		//debugger
		// create an exam schedule based on information about the courses
		// Sample data about courses and instructors
		
		const courses = [
			{ code: "CSE101", date: "2023-01-10", time: "09:00-11:00", room: "A101", proctor1: "", proctor2: ""},
			{ code: "MATH201", date: "2023-01-10", time: "14:00-16:00", room: "B201", proctor1: "", proctor2: ""},
			{ code: "ENG301", date: "2023-01-11", time: "13:00-15:00", room: "C301", proctor1: "", proctor2: ""},
			{ code: "PHYS401", date: "2023-01-11", time: "10:00-12:00", room: "D401", proctor1: "", proctor2: ""},
			{ code: "CHEM501", date: "2023-01-12", time: "11:00-13:00", room: "E501", proctor1: "", proctor2: ""},
			{ code: "BIO601", date: "2023-01-12", time: "16:00-18:00", room: "F601", proctor1: "", proctor2: ""}
		];

		const instructors = [
			{ name: "Dr. Smith", availableTimes: ["09:00-11:00", "14:00-16:00"] },
			{ name: "Prof. Johnson", availableTimes: ["09:00-11:00", "14:00-16:00"] },
			{ name: "Dr. Anderson", availableTimes: ["10:00-12:00", "13:00-15:00"] },
			{ name: "Prof. Martinez", availableTimes: ["08:00-10:00", "12:00-14:00"] },
			{ name: "Dr. Garcia", availableTimes: ["11:00-13:00", "16:00-18:00"] },
			{ name: "Prof. Lee", availableTimes: ["08:00-10:00", "14:00-16:00"] }
		];



		// Initialize an empty calendar
		const schedule = [];

		// Assign instructors to each course
		// instructors[0].availableTimes vs courses[0].time vs courses[1].time: 
		// instructors[1].availableTimes vs courses[0].time vs courses[1].time
		courses.forEach(course => {
			instructors.some(instructor => {
				if (course.time.split("-").some(time => instructor.availableTimes.toString().includes(time))) {
					schedule.push({ course: course.code, proctor1: instructor.name });
					course.proctor1 = instructor.name;
					instructors.splice(instructors.indexOf(instructor), 1); // Remove assigned instructor
					return true;
				}
				return false;
			});
		});
		
		// gan du lieu cho proctor

		// Print exam schedule
		schedule.forEach(entry => {
			console.log(`Khóa học ${entry.course} sẽ được giảng viên ${entry.proctor1} coi thi.`);
		});
		console.log(courses);
	</script>
	<script>
		function exportToExcel() {
			/* Get table element */
			var table = document.getElementById('excel-data');
			
			/* Convert table to workbook */
			var wb = XLSX.utils.table_to_book(table);

			/* Generate Excel file */
			XLSX.writeFile(wb, 'data.xlsx');
		}
	</script>
	<script>
        function handleFile(input) {
            const file = input.files[0];
            const reader = new FileReader();

            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });

                // Get data from the first sheet
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];

                // Convert data to array of objects
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, range: 1, defval: ''});
                // Display data in the browser
                displayData(jsonData);
            };

            reader.readAsArrayBuffer(file);
        }

        function displayData(data) {
            const container = document.getElementById('scheduleBody');
			let html = "";
            data.forEach(row => {
                html += '<tr>';
                row.forEach(cell => {
                    html += `<td>${cell}</td>`;
                });
                html += '</tr>';
            });
			console.log(html);
			container.innerHTML = html;
        }
		
		function reloadPage() {
            sessionStorage.removeItem('savedContent');
            location.reload();
        }
    </script>
	<script>
        function printSchedule() {
            // Open the browser print dialog box
            window.print();
        }
    </script>
	<script>
		/* viet formmat danh sach bang */
        function formatDataDisplay() {
			// Get all cells containing an ellipsis
			var cells = document.querySelectorAll('.container th, .container td');
			cells.forEach(function(cell) {
				// Check if the content exceeds max-width
				if (cell.scrollWidth > cell.offsetWidth) {
					// Reduce the font size until the content does not exceed max-width
					while (cell.scrollWidth > cell.offsetWidth) {
						var fontSize = window.getComputedStyle(cell).fontSize;
						cell.style.fontSize = (parseFloat(fontSize) - 1) + 'px';
					}
				}
			});
		}
    </script>
	<script>
        document.addEventListener('DOMContentLoaded', function() {
			formatDataDisplay();
			console.log('The page has been completely formated.');
            // Perform actions after the page is completely loaded
            console.log('The page has been completely loaded.');
        });
    </script>
	
</body>
</html>
